import{c}from"./utils-DZsthKC1.js";import{$ as i}from"./index-BY-0RLvA.js";import"./index-D-ZhVjb_.js";const m=async n=>{const{content:e,publicKey:o,privateKey:t}=n,s=await g({uncompressedPrivateKeyHex:t,compressedPublicKeyHex:o});return await l({key:s,content:e})};async function g(n){const{uncompressedPrivateKeyHex:e,compressedPublicKeyHex:o}=n,t=c({uncompressedPrivateKeyHex:e,compressedPublicKeyHex:o});return await crypto.subtle.importKey("jwk",t,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"])}async function l(n){const{key:e,content:o}=n,t=await crypto.subtle.sign({name:"ECDSA",hash:"SHA-256"},e,new TextEncoder().encode(o)),s=u(new Uint8Array(t));return i(s)}function u(n){if(n.length%2!=0||n.length==0||n.length>132)throw new Error("Invalid IEEE P1363 signature encoding. Length: "+n.length);const e=a(n.subarray(0,n.length/2)),o=a(n.subarray(n.length/2,n.length));let t=0;const s=2+e.length+1+1+o.length;let r;return s>=128?(r=new Uint8Array(s+3),r[t++]=48,r[t++]=129,r[t++]=s):(r=new Uint8Array(s+2),r[t++]=48,r[t++]=s),r[t++]=2,r[t++]=e.length,r.set(e,t),t+=e.length,r[t++]=2,r[t++]=o.length,r.set(o,t),r}function a(n){let e=0;for(;e<n.length&&n[e]==0;)e++;e==n.length&&(e=n.length-1);let o=0;(n[e]&128)==128&&(o=1);const t=new Uint8Array(n.length-e+o);return t.set(n.subarray(e),o),t}export{m as signWithApiKey};
